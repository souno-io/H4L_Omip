BASE_SQL = """
select
*
from (
SELECT ZYLSH AS 住院号,
       ZYHM AS 住院号码,
       NVL(姓名,'-') AS 姓名,--姓名
       NVL(身份证号,'-') AS 身份证号,--身份证号
       入院科别 AS 入院科别,--
       --出院诊断_主要疾病编码,
       --出院诊断_主要诊断,
       EMR.UF_GET_GL2JB(出院诊断_主要疾病编码,'CODE',1) AS 出院主要诊断编码,
       EMR.UF_GET_GL2JB(出院诊断_主要疾病编码,'NAME',1) AS 出院主要诊断名称,
       EMR.UF_GET_GL2JB(出院诊断_疾病编码1,'CODE',1) AS 出院诊断疾病编码1,
       EMR.UF_GET_GL2JB(出院诊断_疾病编码1,'NAME',1) AS 出院诊断其他诊断1,
       EMR.UF_GET_GL3SS(手术及操作编码1,'CODE',1) AS 主要手术操作编码,
       EMR.UF_GET_GL3SS(手术及操作编码1,'NAME',1) AS 主要手术操作名称,
       CASE WHEN TRUNC(CASE WHEN EMR.ISDATETIME(REPLACE(REPLACE(REPLACE(REPLACE(出院时间,'年','-'),'月','-'),'日',' '),'时',':00:00')) = 1
                            THEN TO_DATE(TO_CHAR(TO_DATE(REPLACE(REPLACE(REPLACE(REPLACE(出院时间,'年','-'),'月','-'),'日',' '),'时',':00:00'),'yyyy-mm-dd hh24:mi:ss'),'yyyy-mm-dd'),'yyyy-mm-dd')
                       ELSE TO_DATE(TO_CHAR(CYRQ,'yyyy-mm-dd'),'yyyy-mm-dd') END
                       -
                       CASE WHEN EMR.ISDATETIME(REPLACE(REPLACE(REPLACE(REPLACE(入院时间,'年','-'),'月','-'),'日',' '),'时',':00:00')) = 1
                            THEN TO_DATE(TO_CHAR(TO_DATE(REPLACE(REPLACE(REPLACE(REPLACE(入院时间,'年','-'),'月','-'),'日',' '),'时',':00:00'),'yyyy-mm-dd hh24:mi:ss'),'yyyy-mm-dd'),'yyyy-mm-dd')
                       ELSE TO_DATE(TO_CHAR(RYRQ,'yyyy-mm-dd'),'yyyy-mm-dd') END) > 1
            THEN TRUNC(CASE WHEN EMR.ISDATETIME(REPLACE(REPLACE(REPLACE(REPLACE(出院时间,'年','-'),'月','-'),'日',' '),'时',':00:00')) = 1
                            THEN TO_DATE(TO_CHAR(TO_DATE(REPLACE(REPLACE(REPLACE(REPLACE(出院时间,'年','-'),'月','-'),'日',' '),'时',':00:00'),'yyyy-mm-dd hh24:mi:ss'),'yyyy-mm-dd'),'yyyy-mm-dd')
                       ELSE TO_DATE(TO_CHAR(CYRQ,'yyyy-mm-dd'),'yyyy-mm-dd') END
                       -
                       CASE WHEN EMR.ISDATETIME(REPLACE(REPLACE(REPLACE(REPLACE(入院时间,'年','-'),'月','-'),'日',' '),'时',':00:00')) = 1
                            THEN TO_DATE(TO_CHAR(TO_DATE(REPLACE(REPLACE(REPLACE(REPLACE(入院时间,'年','-'),'月','-'),'日',' '),'时',':00:00'),'yyyy-mm-dd hh24:mi:ss'),'yyyy-mm-dd'),'yyyy-mm-dd')
                       ELSE TO_DATE(TO_CHAR(RYRQ,'yyyy-mm-dd'),'yyyy-mm-dd') END)
       ELSE 1 END AS 住院天数,
       TO_NUMBER(NVL(总费用,'0.00')) AS 总费用,
       NVL(离院方式,'9') AS 离院方式,
       BRXZ
FROM (
SELECT EMR_BL_BL01.BLBH,
       EMR_BL_BL01.JZHM,
       EMR_BL_BL01.BLZT,
       R.RYRQ AS RYRQ,
       R.CYRQ AS CYRQ,
       R.ZYH AS ZYLSH,
       R.BRXZ AS BRXZ,
       R.BRXM AS BRXM,
       R.ZYHM AS ZYHM,
       EMR_BL_BASYSJ.XMMC,
       DECODE(R.RJSS,1,'1','0') AS 是否为日间手术,
       TRIM(CASE EMR_BL_BASYSJ.XMMC WHEN '医疗付费方式' THEN CASE EMR_BL_BASYSJ.XMQZ WHEN '1' THEN '1.1' WHEN '1.1' THEN '1.1' WHEN '1.2' THEN '1.2' WHEN '2' THEN '2.1' WHEN '2.1' THEN '2.1' WHEN '2.2' THEN '2.2' WHEN '3' THEN '3.1' WHEN '3.1' THEN '3.1' WHEN '3.2' THEN '3.2' WHEN '4' THEN '4' WHEN '5' THEN '5' WHEN '6' THEN '6' WHEN '7' THEN '7' WHEN '8' THEN '8' ELSE '9' END ELSE EMR_BL_BASYSJ.XMQZ END) AS XMQZ
FROM HIS.BA_BRSY A
INNER JOIN EMR.EMR_BL_BL01 ON EMR_BL_BL01.JZHM = TO_CHAR(A.ZYH) AND EMR_BL_BL01.BLZT <> 9
INNER JOIN EMR.EMR_BL_BASYSJ ON EMR_BL_BASYSJ.BLBH = EMR_BL_BL01.BLBH
INNER JOIN HIS.ZY_BRRY R ON R.ZYH = A.ZYH
WHERE A.CYRQ >= To_Date('${start_date}', 'yyyy-mm-dd') AND A.CYRQ < To_Date('${end_date}', 'yyyy-mm-dd')
)
PIVOT (MAX(XMQZ) FOR XMMC IN
(
'组织机构代码' AS 组织机构代码,
'医疗付费方式' AS 医疗付费方式,
'健康卡号' AS 健康卡号,
'第几次住院' AS 第几次住院,
'病案号' AS 病案号,
'姓名' AS 姓名,
'性别' AS 性别,
'出生日期' AS 出生日期,
'年龄' AS 年龄,
'国籍' AS 国籍,
'新生儿年龄' AS 新生儿年龄,
'新生儿出生体重' AS 新生儿出生体重,
'新生儿入院体重' AS 新生儿入院体重,
'出生地' AS 出生地,
'籍贯' AS 籍贯,
'民族' AS 民族,
'身份证号' AS 身份证号,
'职业' AS 职业,
'婚姻' AS 婚姻,
'现住址' AS 现住址,
'现住址电话' AS 现住址电话,
'现住址邮编' AS 现住址邮编,
'户口地址' AS 户口地址,
'户口邮编' AS 户口邮编,
'工作单位及地址' AS 工作单位及地址,
'单位电话' AS 单位电话,
'单位邮编' AS 单位邮编,
'联系人姓名' AS 联系人姓名,
'联系人关系' AS 联系人关系,
'联系人地址' AS 联系人地址,
'联系人电话' AS 联系人电话,
'入院途径' AS 入院途径,
'入院时间' AS 入院时间,
'入院科别' AS 入院科别,
'入院病房' AS 入院病房,
'转科科别' AS 转科科别,
'出院时间' AS 出院时间,
'出院科别' AS 出院科别,
'出院病房' AS 出院病房,
'实际住院天数' AS 实际住院天数,
'门急诊诊断' AS 门急诊诊断,
'门急诊诊断疾病编码' AS 门急诊诊断疾病编码,
'出院诊断_主要诊断' AS 出院诊断_主要诊断,
'出院诊断_主要疾病编码' AS 出院诊断_主要疾病编码,
'出院诊断_其他诊断1' AS 出院诊断_其他诊断1,
'出院诊断_其他诊断2' AS 出院诊断_其他诊断2,
'出院诊断_其他诊断3' AS 出院诊断_其他诊断3,
'出院诊断_其他诊断4' AS 出院诊断_其他诊断4,
'出院诊断_其他诊断5' AS 出院诊断_其他诊断5,
'出院诊断_其他诊断6' AS 出院诊断_其他诊断6,
'出院诊断_其他诊断7' AS 出院诊断_其他诊断7,
'出院诊断_其他诊断8' AS 出院诊断_其他诊断8,
'出院诊断_其他诊断9' AS 出院诊断_其他诊断9,
'出院诊断_其他诊断10' AS 出院诊断_其他诊断10,
'出院诊断_其他诊断11' AS 出院诊断_其他诊断11,
'出院诊断_其他诊断12' AS 出院诊断_其他诊断12,
'出院诊断_其他诊断13' AS 出院诊断_其他诊断13,
'出院诊断_其他诊断14' AS 出院诊断_其他诊断14,
'出院诊断_其他诊断15' AS 出院诊断_其他诊断15,
'出院诊断_其他诊断16' AS 出院诊断_其他诊断16,
'出院诊断_其他诊断17' AS 出院诊断_其他诊断17,
'出院诊断_其他诊断18' AS 出院诊断_其他诊断18,
'出院诊断_其他诊断19' AS 出院诊断_其他诊断19,
'出院诊断_其他诊断20' AS 出院诊断_其他诊断20,
'出院诊断_其他诊断21' AS 出院诊断_其他诊断21,
'出院诊断_其他诊断22' AS 出院诊断_其他诊断22,
'出院诊断_疾病编码1' AS 出院诊断_疾病编码1,
'出院诊断_疾病编码2' AS 出院诊断_疾病编码2,
'出院诊断_疾病编码3' AS 出院诊断_疾病编码3,
'出院诊断_疾病编码4' AS 出院诊断_疾病编码4,
'出院诊断_疾病编码5' AS 出院诊断_疾病编码5,
'出院诊断_疾病编码6' AS 出院诊断_疾病编码6,
'出院诊断_疾病编码7' AS 出院诊断_疾病编码7,
'出院诊断_疾病编码8' AS 出院诊断_疾病编码8,
'出院诊断_疾病编码9' AS 出院诊断_疾病编码9,
'出院诊断_疾病编码10' AS 出院诊断_疾病编码10,
'出院诊断_疾病编码11' AS 出院诊断_疾病编码11,
'出院诊断_疾病编码12' AS 出院诊断_疾病编码12,
'出院诊断_疾病编码13' AS 出院诊断_疾病编码13,
'出院诊断_疾病编码14' AS 出院诊断_疾病编码14,
'出院诊断_疾病编码15' AS 出院诊断_疾病编码15,
'出院诊断_疾病编码16' AS 出院诊断_疾病编码16,
'出院诊断_疾病编码17' AS 出院诊断_疾病编码17,
'出院诊断_疾病编码18' AS 出院诊断_疾病编码18,
'出院诊断_疾病编码19' AS 出院诊断_疾病编码19,
'出院诊断_疾病编码20' AS 出院诊断_疾病编码20,
'出院诊断_疾病编码21' AS 出院诊断_疾病编码21,
'出院诊断_疾病编码22' AS 出院诊断_疾病编码22,
'出院诊断_主要入院病情' AS 出院诊断_主要入院病情,
'出院诊断_入院病情1' AS 出院诊断_入院病情1,
'出院诊断_入院病情2' AS 出院诊断_入院病情2,
'出院诊断_入院病情3' AS 出院诊断_入院病情3,
'出院诊断_入院病情4' AS 出院诊断_入院病情4,
'出院诊断_入院病情5' AS 出院诊断_入院病情5,
'出院诊断_入院病情6' AS 出院诊断_入院病情6,
'出院诊断_入院病情7' AS 出院诊断_入院病情7,
'出院诊断_入院病情8' AS 出院诊断_入院病情8,
'出院诊断_入院病情9' AS 出院诊断_入院病情9,
'出院诊断_入院病情10' AS 出院诊断_入院病情10,
'出院诊断_入院病情11' AS 出院诊断_入院病情11,
'出院诊断_入院病情12' AS 出院诊断_入院病情12,
'出院诊断_入院病情13' AS 出院诊断_入院病情13,
'出院诊断_入院病情14' AS 出院诊断_入院病情14,
'出院诊断_入院病情15' AS 出院诊断_入院病情15,
'出院诊断_入院病情16' AS 出院诊断_入院病情16,
'出院诊断_入院病情17' AS 出院诊断_入院病情17,
'出院诊断_入院病情18' AS 出院诊断_入院病情18,
'出院诊断_入院病情19' AS 出院诊断_入院病情19,
'出院诊断_入院病情20' AS 出院诊断_入院病情20,
'出院诊断_入院病情21' AS 出院诊断_入院病情21,
'出院诊断_入院病情22' AS 出院诊断_入院病情22,
'损伤中毒外部原因' AS 损伤中毒外部原因,
'损伤中毒疾病编码' AS 损伤中毒疾病编码,
'病理诊断1' AS 病理诊断1,
'病理诊断2' AS 病理诊断2,
'病理诊断疾病编码' AS 病理诊断疾病编码,
'病理号' AS 病理号,
'过敏药物' AS 过敏药物,
'药物过敏' AS 药物过敏,
'死亡患者尸检' AS 死亡患者尸检,
'血型' AS 血型,
'RH' AS RH,
'科主任' AS 科主任,
'主任副主任医师' AS 主任副主任医师,
'主治医师' AS 主治医师,
'住院医师' AS 住院医师,
'编码员' AS 编码员,
'进修医师' AS 进修医师,
'实习医师' AS 实习医师,
'责任护士' AS 责任护士,
'质控护士' AS 质控护士,
'质控医师' AS 质控医师,
'病案质量' AS 病案质量,
'质控日期' AS 质控日期,
'离院方式' AS 离院方式,
'医嘱转院接收医疗机构' AS 医嘱转院接收医疗机构,
'医嘱转社区接收医疗机构' AS 医嘱转社区接收医疗机构,
'31天再住院计划' AS 三十一天再住院计划,
'31天再住院目的' AS 三十一天再住院目的,
'昏迷入院前天' AS 昏迷入院前天,
'昏迷入院前小时' AS 昏迷入院前小时,
'昏迷入院前分钟' AS 昏迷入院前分钟,
'昏迷入院后天' AS 昏迷入院后天,
'昏迷入院后小时' AS 昏迷入院后小时,
'昏迷入院后分钟' AS 昏迷入院后分钟,
'手术及操作编码1' AS 手术及操作编码1,
'手术及操作编码2' AS 手术及操作编码2,
'手术及操作编码3' AS 手术及操作编码3,
'手术及操作编码4' AS 手术及操作编码4,
'手术及操作编码5' AS 手术及操作编码5,
'手术及操作编码6' AS 手术及操作编码6,
'手术及操作编码7' AS 手术及操作编码7,
'手术及操作编码8' AS 手术及操作编码8,
'手术及操作日期1' AS 手术及操作日期1,
'手术及操作日期2' AS 手术及操作日期2,
'手术及操作日期3' AS 手术及操作日期3,
'手术及操作日期4' AS 手术及操作日期4,
'手术及操作日期5' AS 手术及操作日期5,
'手术及操作日期6' AS 手术及操作日期6,
'手术及操作日期7' AS 手术及操作日期7,
'手术及操作日期8' AS 手术及操作日期8,
'手术级别1' AS 手术级别1,
'手术级别2' AS 手术级别2,
'手术级别3' AS 手术级别3,
'手术级别4' AS 手术级别4,
'手术级别5' AS 手术级别5,
'手术级别6' AS 手术级别6,
'手术级别7' AS 手术级别7,
'手术级别8' AS 手术级别8,
'手术及操作名称1' AS 手术及操作名称1,
'手术及操作名称2' AS 手术及操作名称2,
'手术及操作名称3' AS 手术及操作名称3,
'手术及操作名称4' AS 手术及操作名称4,
'手术及操作名称5' AS 手术及操作名称5,
'手术及操作名称6' AS 手术及操作名称6,
'手术及操作名称7' AS 手术及操作名称7,
'手术及操作名称8' AS 手术及操作名称8,
'术者1' AS 术者1,
'术者2' AS 术者2,
'术者3' AS 术者3,
'术者4' AS 术者4,
'术者5' AS 术者5,
'术者6' AS 术者6,
'术者7' AS 术者7,
'术者8' AS 术者8,
'1助1' AS I助1,
'1助2' AS I助2,
'1助3' AS I助3,
'1助4' AS I助4,
'1助5' AS I助5,
'1助6' AS I助6,
'1助7' AS I助7,
'1助8' AS I助8,
'2助1' AS II助1,
'2助2' AS II助2,
'2助3' AS II助3,
'2助4' AS II助4,
'2助5' AS II助5,
'2助6' AS II助6,
'2助7' AS II助7,
'2助8' AS II助8,
'切口类别1' AS 切口类别1,
'切口类别2' AS 切口类别2,
'切口类别3' AS 切口类别3,
'切口类别4' AS 切口类别4,
'切口类别5' AS 切口类别5,
'切口类别6' AS 切口类别6,
'切口类别7' AS 切口类别7,
'切口类别8' AS 切口类别8,
'愈合等级1' AS 愈合等级1,
'愈合等级2' AS 愈合等级2,
'愈合等级3' AS 愈合等级3,
'愈合等级4' AS 愈合等级4,
'愈合等级5' AS 愈合等级5,
'愈合等级6' AS 愈合等级6,
'愈合等级7' AS 愈合等级7,
'愈合等级8' AS 愈合等级8,
'麻醉方式1' AS 麻醉方式1,
'麻醉方式2' AS 麻醉方式2,
'麻醉方式3' AS 麻醉方式3,
'麻醉方式4' AS 麻醉方式4,
'麻醉方式5' AS 麻醉方式5,
'麻醉方式6' AS 麻醉方式6,
'麻醉方式7' AS 麻醉方式7,
'麻醉方式8' AS 麻醉方式8,
'麻醉医师1' AS 麻醉医师1,
'麻醉医师2' AS 麻醉医师2,
'麻醉医师3' AS 麻醉医师3,
'麻醉医师4' AS 麻醉医师4,
'麻醉医师5' AS 麻醉医师5,
'麻醉医师6' AS 麻醉医师6,
'麻醉医师7' AS 麻醉医师7,
'麻醉医师8' AS 麻醉医师8,
'总费用' AS 总费用,
'自付金额' AS 自付金额,
'一般医疗服务费' AS 一般医疗服务费,
'一般治疗操作费' AS 一般治疗操作费,
'护理费' AS 护理费,
'其他费用' AS 其他费用,
'病理诊断费' AS 病理诊断费,
'实验室诊断费' AS 实验室诊断费,
'影像学诊断费' AS 影像学诊断费,
'临床诊断项目费' AS 临床诊断项目费,
'非手术治疗项目费' AS 非手术治疗项目费,
'临床物理治疗费' AS 临床物理治疗费,
'手术治疗费' AS 手术治疗费,
'麻醉费' AS 麻醉费,
'手术费' AS 手术费,
'康复费' AS 康复费,
'中医治疗费' AS 中医治疗费,
'西药费' AS 西药费,
'抗菌药物费用' AS 抗菌药物费用,
'中成药费' AS 中成药费,
'中草药费' AS 中草药费,
'血费' AS 血费,
'白蛋白类制品费' AS 白蛋白类制品费,
'球蛋白类制品费' AS 球蛋白类制品费,
'凝血因子类制品费' AS 凝血因子类制品费,
'细胞因子类制品费' AS 细胞因子类制品费,
'检查用一次性医用材料费' AS 检查用一次性医用材料费,
'治疗用一次性医用材料费' AS 治疗用一次性医用材料费,
'手术用一次性医用材料费' AS 手术用一次性医用材料费,
'其他费' AS 其他费,
'抢救次数' AS 抢救次数,
'成功次数' AS 成功次数,
'入院病情' AS 入院病情))
) JK4
"""
